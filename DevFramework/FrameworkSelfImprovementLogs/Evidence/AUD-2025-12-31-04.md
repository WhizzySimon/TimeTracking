# Evidence Bundle: FIX-update-banner

## Audit Context

- **Task ID:** FIX-update-banner
- **Box Type:** bugfix

---

## Acceptance Criteria (REQUIRED)

- [x] Update banner MUST NOT show when offline (navigator.onLine=false OR version fetch fails)
- [x] Update banner MUST show only when available version differs from current build AND user is online
- [x] Update banner MUST NOT reappear endlessly on reload/new tab (sessionStorage gating)
- [x] Update banner MUST clear after successful update
- [x] SW MUST NOT cache version.json (always network-fresh)
- [x] Offline cold-start and refresh MUST still work (app shell cached)
- [x] npm run check passes with 0 errors

---

## Planned Scope (recommended)

- **Planned files/areas:**
  - `src/lib/pwa/update.ts` — rewrite with offline safety + version comparison + sessionStorage
  - `vite.config.ts` — inject `__APP_BUILD_ID__` compile-time constant
  - `src/app.d.ts` — TypeScript declaration for `__APP_BUILD_ID__`
  - `static/sw.js` — remove version.json from cache, add network-only handling
  - `static/sw.template.js` — same changes as sw.js
- **Out-of-scope:** UI changes, sync logic, other PWA features

---

## Commands Run + Results

| Command          | Exit Code | Notes                          |
| ---------------- | --------- | ------------------------------ |
| `npm run format` | 0         | All files formatted            |
| `npm run check`  | 0         | 0 errors, 4 pre-existing warns |

---

## Decision Links (optional)

- `DevFramework/FrameworkSelfImprovementLogs/DECISIONS.md` — none
- Related specs/plans: N/A (ad-hoc bugfix)

---

## Auditor Section (filled by /audit)

### Snapshot Identifiers

- **BASE_HEAD:** ad615da47d1611e61fd0b1b92f54590312755fb3
- **STAGED_DIFF_HASH:** 062fd25fbe9dae6eb94705d9472966f3c2aa45b6

### Audit Verdict

- **Date:** 2025-12-31
- **Verdict:** PASS
- **Notes:** All 7 acceptance criteria met. Minor naming warning (controllerChangeHandled should have `is` prefix) - not a blocker. Risk: LOW.
